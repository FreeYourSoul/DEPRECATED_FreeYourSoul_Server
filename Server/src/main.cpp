#include <spdlog/spdlog.h>
#include <Gateway.hh>
#include <Babble.hh>
#include <Authenticator.hh>


static const std::string welcomeMsg =
        "\n\n"
        "              . .    .. ............,.,...,.,..,...,..........  .                         \n"
        "                     ......... ......,...,,,,,.,,,,,,,,,,,,...,..........  .  .                    \n"
        "                  .. .... ..........,..,,,,,,,,,,,,***,,,,,,,,,,..........   .                     \n"
        "                   . ................,,,,,,,*****////////**,,,,,.,.......... . .                   \n"
        "               ..  ......,......,.,,,,*,*****//((&@@&((//****,,,,,,,............                   \n"
        "               ........,.......,,,,,,,*****/%@@@@#((((///******,*,,..,,............ .  .           \n"
        "                 . .........,,,,,,,,******/@@@@@@@&%(((/////******,,,,.,,.......,...               \n"
        "                . ........,.,,,,*********///((#&@@@@@@@@(///*****,,,,......... . .. .            \n"
        "          .  .............,,,,,,,,,****////(((#%@@@@@@@@@@@@///****,,*,,............ . .           \n"
        "         . . ..........,,,,,,,,,,,****///((#@@@@@@@@@@@(((////***,,,,,,..,......... .            \n"
        "            ..........,,,,,,,,,,,****//((#@@@@@@@@@@@###((((////******,,*,,,,......... .           \n"
        "       .   . .. ......,.,,,,,,,*****//(((#%@@@@@@@@@@@@#((((///*****,,*,,,.....,....  .          \n"
        "       . .. .. ......,.,,,,,,*****///((#@@@@@@@@@@@@@@@@@@@#(((////***,,,,,,,.,,....   . .         \n"
        "     .   . .. . ....,.,,,,,,******//(#@@@@@@@@@@@@@@@@@@@@@@@#((///****,,,,,,,,......... .         \n"
        "          ............,,,,,******//(#@@@@@@@@@@@@@@@@@@@@@@@@@%((//*****,,,,,...,....  .           \n"
        "         . .. .........,,,,*****//(#@@@@@@@@@@@@@@@@@@@@@@@@@@@%(//*****,,,,,,.......              \n"
        "      .  . ...........,,,,,,****/((@@@@@@@@@@@@@@@@@@@@@@@@@@@@@(//*****,,,,.,...... ..            \n"
        "        . . ...........,,,,,,***/(#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@(//****,,,,,,.......               \n"
        "     . ..  ...........,,,,,,,***//(@@@@@@@@@@@@@@@@@@@@@@@@@@@@@(//*****,,,.,..... ..              \n"
        "          .. .........,.,,,,,***//(&@@@@@@@@@@@@@@@@@@@@@@@@@@@%(//*****,,,,,..........            \n"
        "             . ........,,,,,,****//(&@@@@@@@@@@@@@@@@@@@@@@@@@&(//****,,,,...........              \n"
        "              ...........,,,,,****//(@@@@@@@@@@@@@@@@@@@@@@@@%///****,,,,,,........                \n"
        "            .. ...........,,,,,****///#@@@@@@@@@@@@@@@@@@@@&(//*****,,,,,........                  \n"
        "              .. ..........,,,,,,****//((&@@@@@@@@@@@@@@@#(//*****,,,,.......... .                 \n"
        "            .  ............,,,,,,,,*****///(#&@@@@@@&%(////*****,,,,,,,........ .                  \n"
        "                . ........,.,,,,,,,,,*******//////////*******,,,,,,,,,,..........                  \n"
        "                      .......,,,,,,,,,,,,,,*************,,,,,,,,,,,.......... .  .                 \n\n"
        "oooooooooooo                             .oooooo.                  .                                                    \n"
        "`888'     `8                            d8P'  `Y8b               .o8                                                    \n"
        " 888         oooo    ooo  .oooo.o      888            .oooo.   .o888oo  .ooooo.  oooo oooo    ooo  .oooo.   oooo    ooo \n"
        " 888oooo8     `88.  .8'  d88(  \"8      888           `P  )88b    888   d88' `88b  `88. `88.  .8'  `P  )88b   `88.  .8'  \n"
        " 888    \"      `88..8'   `\"Y88b.       888     ooooo  .oP\"888    888   888ooo888   `88..]88..8'    .oP\"888    `88..8'   \n"
        " 888            `888'    o.  )88b      `88.    .88'  d8(  888    888 . 888    .o    `888'`888'    d8(  888     `888'    \n"
        "o888o            .8'     8\"\"888P'       `Y8bood8P'   `Y888\"\"8o   \"888\" `Y8bod8P'     `8'  `8'     `Y888\"\"8o     .8'     \n"
        "             .o..P'                                                                                         .o..P'      \n"
        "             `Y8P'                                                                                          `Y8P'       \n"
        "                                                                                                                        \n\n\n";

void welcome(bool verbose) {
    spdlog::set_async_mode(1024);
    spdlog::set_pattern("[%x %H:%M:%S] [%l] %v");

    std::vector<spdlog::sink_ptr> sinks;

    if (verbose) {
        auto stdout_sink = spdlog::sinks::stdout_sink_mt::instance();
        auto color_sink = std::make_shared<spdlog::sinks::ansicolor_sink>(stdout_sink);
        sinks.push_back(color_sink);
    }
    auto sys_logger = std::make_shared<spdlog::logger>("c", begin(sinks), end(sinks));
#ifdef DEBUG_LEVEL
    sys_logger->set_level(spdlog::level::debug);
#else
    sys_logger->set_level(spdlog::level::debug);
#endif
    spdlog::register_logger(sys_logger);
    sys_logger->info("Logger set to level {}", spdlog::get("c")->level());
    spdlog::get("c")->info(welcomeMsg);
}

int main(int argc, const char * const *argv) {
    GOOGLE_PROTOBUF_VERIFY_VERSION;
    fys::gateway::Context ctx(argc, argv);
    welcome(ctx.isVerbose());
    ctx.logContext();
    fys::gateway::Gateway::start(ctx);
    google::protobuf::ShutdownProtobufLibrary();
    return 0;
}
